<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dino Game - Siêu Ổn Định</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f7f7f7; font-family: Arial, sans-serif; overflow: hidden; }
        #game-container { position: relative; width: 800px; }
        canvas { background-color: #fff; border-bottom: 2px solid #535353; border-radius: 4px; }
        #play-again { position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); display: none; padding: 12px 24px; font-size: 18px; background-color: #535353; color: white; border: none; cursor: pointer; border-radius: 4px; }
        .score { position: absolute; top: 10px; right: 10px; font-size: 24px; color: #535353; font-family: monospace; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="score" id="score">00000</div>
    <canvas id="gameCanvas" width="800" height="200"></canvas>
    <button id="play-again" onclick="resetGame()">CHƠI LẠI</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const btnPlayAgain = document.getElementById('play-again');
    const scoreElement = document.getElementById('score');

    let score = 0;
    let gameSpeed = 5;
    let isGameOver = false;
    let animationId;

    const dino = {
        x: 50, y: 150, w: 40, h: 40,
        dy: 0, jumpF: 12, grav: 0.6,
        grounded: false
    };

    let obstacles = [];

    // Điều khiển
    window.addEventListener('keydown', (e) => {
        if ((e.code === 'Space' || e.code === 'ArrowUp') && dino.grounded) {
            dino.dy = -dino.jumpF;
            dino.grounded = false;
        }
    });

    // Chạm màn hình để nhảy
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (dino.grounded) { dino.dy = -dino.jumpF; dino.grounded = false; }
    });

    function createObstacle() {
        let h = Math.random() * 30 + 30; // Chiều cao ngẫu nhiên
        obstacles.push({
            x: canvas.width,
            y: 200 - h,
            w: 20,
            h: h
        });
    }

    function update() {
        if (isGameOver) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Trọng lực khủng long
        dino.dy += dino.grav;
        dino.y += dino.dy;

        if (dino.y + dino.h > 200) {
            dino.y = 200 - dino.h;
            dino.dy = 0;
            dino.grounded = true;
        }

        // Vẽ Khủng long (Dạng hình khối Pixel)
        ctx.fillStyle = "#535353";
        ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
        // Vẽ mắt cho khủng long
        ctx.fillStyle = "white";
        ctx.fillRect(dino.x + 25, dino.y + 10, 5, 5);

        // Xử lý Vật cản
        if (Math.random() < 0.02 && (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 300)) {
            createObstacle();
        }

        obstacles.forEach((obs, i) => {
            obs.x -= gameSpeed;

            // Vẽ Xương rồng (Dạng hình khối)
            ctx.fillStyle = "#535353";
            ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
            // Vẽ cành xương rồng
            ctx.fillRect(obs.x - 5, obs.y + 10, 5, 5);
            ctx.fillRect(obs.x + 20, obs.y + 15, 5, 5);

            // Kiểm tra va chạm
            if (dino.x < obs.x + obs.w && dino.x + dino.w > obs.x &&
                dino.y < obs.y + obs.h && dino.y + dino.h > obs.y) {
                gameOver();
            }

            // Xóa vật cản đã trôi qua và tăng điểm
            if (obs.x < -20) {
                obstacles.splice(i, 1);
                score++;
                gameSpeed += 0.1; // Tăng tốc độ dần dần
                scoreElement.innerText = score.toString().padStart(5, '0');
            }
        });

        animationId = requestAnimationFrame(update);
    }

    function gameOver() {
        isGameOver = true;
        cancelAnimationFrame(animationId);
        
        ctx.fillStyle = "rgba(0,0,0,0.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = "#535353";
        ctx.font = "bold 40px Arial";
        ctx.textAlign = "center";
        ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
        
        btnPlayAgain.style.display = 'block';
    }

    function resetGame() {
        score = 0;
        gameSpeed = 5;
        isGameOver = false;
        obstacles = [];
        dino.y = 150;
        dino.dy = 0;
        scoreElement.innerText = "00000";
        btnPlayAgain.style.display = 'none';
        update();
    }

    // Khởi động game
    update();
</script>
</body>
</html>